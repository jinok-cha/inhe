(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))y(e);new MutationObserver(e=>{for(const u of e)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&y(p)}).observe(document,{childList:!0,subtree:!0});function h(e){const u={};return e.integrity&&(u.integrity=e.integrity),e.referrerPolicy&&(u.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?u.credentials="include":e.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function y(e){if(e.ep)return;e.ep=!0;const u=h(e);fetch(e.href,u)}})();const O=()=>{const c=document.getElementById("save-pdf-btn");let r=0;const h=50,y=setInterval(()=>{window.html2canvas&&window.jspdf?(clearInterval(y),z()):(r++,r>h&&(clearInterval(y),console.error("PDF generation libraries could not be loaded."),c&&(c.textContent="PDF 저장 불가",c.disabled=!0,alert("PDF 저장 기능을 불러오지 못했습니다. 광고 차단기를 비활성화하거나 네트워크 연결을 확인 후 새로고침해주세요."))))},100)},z=()=>{const c={hasSpouse:document.getElementById("has-spouse"),numChildren:document.getElementById("num-children"),childrenDecrement:document.getElementById("children-decrement"),childrenIncrement:document.getElementById("children-increment"),stockValue:document.getElementById("stock-value"),financialAssets:document.getElementById("financial-assets"),realEstate:document.getElementById("real-estate"),deemedAssets:document.getElementById("deemed-assets"),debt:document.getElementById("debt"),totalInheritanceValue:document.getElementById("total-inheritance-value"),financialAssetDeduction:document.getElementById("financial-asset-deduction"),lumpSumDeduction:document.getElementById("lump-sum-deduction"),spouseDeduction:document.getElementById("spouse-deduction"),taxBase:document.getElementById("tax-base"),estimatedTax:document.getElementById("estimated-tax"),savePdfBtn:document.getElementById("save-pdf-btn")},r={stockRate:document.getElementById("stock-rate"),stockRateDecrement:document.getElementById("stock-rate-decrement"),stockRateIncrement:document.getElementById("stock-rate-increment"),financialRate:document.getElementById("financial-rate"),financialRateDecrement:document.getElementById("financial-rate-decrement"),financialRateIncrement:document.getElementById("financial-rate-increment"),realEstateRate:document.getElementById("real-estate-rate"),realEstateRateDecrement:document.getElementById("real-estate-rate-decrement"),realEstateRateIncrement:document.getElementById("real-estate-rate-increment"),chartContainer:document.getElementById("chart-container"),detailsTbody:document.getElementById("details-tbody")},h={card:document.getElementById("second-simulation-card"),chartContainer:document.getElementById("chart-container-2"),detailsTbody:document.getElementById("details-tbody-2"),yearsPassed:document.getElementById("years-passed")},y={modal:document.getElementById("pdf-name-modal"),fileNameInput:document.getElementById("pdf-file-name"),confirmBtn:document.getElementById("confirm-pdf-name"),cancelBtn:document.getElementById("cancel-pdf-name")},e={hasSpouse:!0,numChildren:1,stockValue:30,financialAssets:0,realEstate:0,deemedAssets:0,debt:0,stockGrowthRate:2.5,financialGrowthRate:2.5,realEstateGrowthRate:2,stockValue2:0,financialAssets2:0,realEstate2:0,deemedAssets2:0,debt2:0,yearsPassed:0,isSecondSimInitialized:!1},u=a=>a&&parseFloat(a.value)||0,p=a=>`${a.toFixed(1)} 억원`,V=(a,t)=>{let s;return(...n)=>{clearTimeout(s),s=window.setTimeout(()=>a.apply(null,n),t)}},D=(a,t,s,n=!1)=>{if(!t||s<0)return 0;const m=1.5,f=s*1,i=m+f,l=i>0?a*(m/i):a;return n?l:Math.max(5,Math.min(30,l))},R=(a,t,s,n)=>{const m=Math.min(t*.2,2),f=5,i=s?D(a,s,n):0,l=m+f+i,d=Math.max(0,a-l);let o=0;return d>0&&(d<=1?o=d*.1:d<=5?o=d*.2-.1:d<=10?o=d*.3-.6:d<=30?o=d*.4-1.6:o=d*.5-4.6),{financialAssetDeduction:m,lumpSumDeduction:f,spouseDeduction:i,taxBase:d,estimatedTax:Math.max(0,o)}},G=()=>{const t=e.stockValue+e.financialAssets+e.realEstate+e.deemedAssets-e.debt,s=e.stockValue+e.financialAssets,n=R(t,s,e.hasSpouse,e.numChildren);c.totalInheritanceValue.textContent=p(t),c.financialAssetDeduction.textContent=p(n.financialAssetDeduction),c.lumpSumDeduction.textContent=p(n.lumpSumDeduction),c.spouseDeduction.textContent=p(n.spouseDeduction),c.taxBase.textContent=p(n.taxBase),c.estimatedTax.textContent=p(n.estimatedTax)},L=()=>{const a=[0,10,20,30],t=(i,l)=>Math.pow(1+i/100,l),s=a.map(i=>{const l=e.stockValue*t(e.stockGrowthRate,i),d=e.financialAssets*t(e.financialGrowthRate,i),o=e.realEstate*t(e.realEstateGrowthRate,i),E=l+d+o+e.deemedAssets-e.debt,g=l+d,v=R(E,g,e.hasSpouse,e.numChildren);return{years:i,totalAssets:E,stock:l,financial:d,realEstate:o,...v}}),n=e.yearsPassed,m=n<=0?0:Math.min(1,n/10),f=a.map(i=>{const l=s.find(x=>x.years===i),o=D(l.totalAssets,e.hasSpouse,e.numChildren,!0)-l.estimatedTax,E=e.stockValue2*t(e.stockGrowthRate,i),g=e.financialAssets2*t(e.financialGrowthRate,i),v=e.realEstate2*t(e.realEstateGrowthRate,i),I=E+g+v+e.deemedAssets2-e.debt2+o*m,A=E+g,k=R(I,A,!1,e.numChildren);return{years:i,totalAssets:I,stock:E,financial:g,realEstate:v,deemedAssets:e.deemedAssets2,debt:e.debt2,firstInheritanceAsset:o,...k}});S(s,r.chartContainer),w(s,r.detailsTbody,!1),S(f,h.chartContainer),w(f,h.detailsTbody,!0)},$=V(L,400),S=(a,t)=>{if(!t)return;const s=Math.max(...a.map(n=>n.totalAssets),1);t.innerHTML=a.map(n=>`
            <div class="chart-bar-group">
                <div class="chart-bars">
                    <div class="chart-bar asset-bar" style="height: ${n.totalAssets/s*100}%">
                        <span class="bar-label">${n.totalAssets.toFixed(1)}</span>
                    </div>
                    <div class="chart-bar tax-bar" style="height: ${n.estimatedTax/s*100}%">
                        <span class="bar-label">${n.estimatedTax.toFixed(1)}</span>
                    </div>
                </div>
                <span class="x-axis-label">${n.years===0?"현재":`${n.years}년 후`}</span>
            </div>
        `).join("")},w=(a,t,s)=>{if(!t)return;let m=[...[{label:"예상 주식가치",key:"stock"},{label:"예상 금융자산",key:"financial"},{label:"예상 부동산",key:"realEstate"},{label:"총 상속재산",key:"totalAssets"},{label:"금융재산공제",key:"financialAssetDeduction"},{label:"일괄공제/기타공제",key:"lumpSumDeduction"},{label:"배우자 공제",key:"spouseDeduction"},{label:"과세표준",key:"taxBase"},{label:"예상 상속세액",key:"estimatedTax",highlight:!0}]];const f=["stock","financial","realEstate","deemedAssets","debt"];if(s){m.unshift({label:"1차상속 자산",key:"firstInheritanceAsset"});const i=m.findIndex(l=>l.key==="realEstate");i!==-1&&m.splice(i+1,0,{label:"간주상속재산",key:"deemedAssets"},{label:"채무",key:"debt"})}t.innerHTML=m.map(i=>{const l=[];return i.highlight&&l.push("highlight"),s&&(i.key==="totalAssets"||i.key==="firstInheritanceAsset")&&l.push("gray-bg"),`
            <tr class="${l.join(" ")}">
                <td>${i.label}</td>
                ${a.map((d,o)=>s&&o===0&&f.includes(i.key)?`
                            <td>
                                <div class="input-wrapper-table">
                                    <input type="number" class="table-input" data-asset-key="${i.key}" value="${d[i.key].toFixed(1)}">
                                    <span>&nbsp;억원</span>
                                </div>
                            </td>
                        `:`<td>${p(d[i.key]<0?0:d[i.key])}</td>`).join("")}
            </tr>
        `}).join("")},M=()=>new Promise(a=>{const t=y.modal,s=y.fileNameInput,n=y.confirmBtn,m=y.cancelBtn;s.value="상속세_계산_결과",t.classList.remove("hidden"),s.focus(),s.select();const f=o=>{t.classList.add("hidden"),n.removeEventListener("click",i),m.removeEventListener("click",l),t.removeEventListener("click",d),a(o)},i=()=>{const o=s.value.trim();o&&f(o)},l=()=>{f(null)},d=o=>{o.target===t&&f(null)};n.addEventListener("click",i,{once:!0}),m.addEventListener("click",l,{once:!0}),t.addEventListener("click",d)}),j=async a=>{const t=c.savePdfBtn;if(t){t.disabled=!0,t.textContent="저장 중...";try{const{jsPDF:s}=window.jspdf,n=new s({orientation:"p",unit:"mm",format:"a4"}),m=document.querySelectorAll(".calculator-card");let f=!0;for(const i of Array.from(m)){if(i.style.display==="none")continue;f||n.addPage();const l=await window.html2canvas(i,{scale:2}),d=l.toDataURL("image/png"),o=10,E=n.internal.pageSize.getWidth()-o*2,g=n.internal.pageSize.getHeight()-o*2,v=l.width,T=l.height,I=v/T;let A=E,k=E/I;k>g&&(k=g,A=g*I);const x=o+(E-A)/2,N=o+(g-k)/2;n.addImage(d,"PNG",x,N,A,k),f=!1}n.save(`${a}.pdf`)}catch(s){console.error("PDF 생성 중 오류가 발생했습니다:",s),alert("PDF를 생성하는 중 오류가 발생했습니다. 다시 시도해주세요.")}finally{t.disabled=!1,t.textContent="PDF로 저장"}}},b=()=>{e.hasSpouse=c.hasSpouse.checked,e.numChildren=u(c.numChildren),e.stockValue=u(c.stockValue),e.financialAssets=u(c.financialAssets),e.realEstate=u(c.realEstate),e.deemedAssets=u(c.deemedAssets),e.debt=u(c.debt),h.card&&(h.card.style.display=e.hasSpouse?"block":"none"),e.isSecondSimInitialized||(e.stockValue2=0,e.financialAssets2=e.financialAssets,e.realEstate2=e.realEstate,e.deemedAssets2=e.deemedAssets,e.debt2=e.debt,e.isSecondSimInitialized=!0),e.stockGrowthRate=parseFloat(r.stockRate.value)||0,e.financialGrowthRate=parseFloat(r.financialRate.value)||0,e.realEstateGrowthRate=parseFloat(r.realEstateRate.value)||0,e.yearsPassed=u(h.yearsPassed),G(),L()};c.childrenDecrement.addEventListener("click",()=>{const a=u(c.numChildren);a>0&&(c.numChildren.value=(a-1).toString(),b())}),c.childrenIncrement.addEventListener("click",()=>{c.numChildren.value=(u(c.numChildren)+1).toString(),b()}),Object.values(c).forEach(a=>{a&&typeof a.addEventListener=="function"&&a.tagName==="INPUT"&&(a.addEventListener("input",b),a.type==="number"&&a.addEventListener("focus",t=>{t.target.select()}))}),c.savePdfBtn.addEventListener("click",async()=>{const a=await M();a&&await j(a)});const B=(a,t)=>s=>{let n=parseFloat(t.value)||0;n=Math.max(-100,n+s),e[a]=n,t.value=`${n.toFixed(1)}%`,b()},F=B("stockGrowthRate",r.stockRate),P=B("financialGrowthRate",r.financialRate),C=B("realEstateGrowthRate",r.realEstateRate);r.stockRateDecrement.addEventListener("click",()=>F(-.1)),r.stockRateIncrement.addEventListener("click",()=>F(.1)),r.financialRateDecrement.addEventListener("click",()=>P(-.1)),r.financialRateIncrement.addEventListener("click",()=>P(.1)),r.realEstateRateDecrement.addEventListener("click",()=>C(-.1)),r.realEstateRateIncrement.addEventListener("click",()=>C(.1)),h.detailsTbody&&(h.detailsTbody.addEventListener("input",a=>{const t=a.target;if(t&&t.classList.contains("table-input")){const s=t.dataset.assetKey,n=parseFloat(t.value)||0;s==="stock"?e.stockValue2=n:s==="financial"?e.financialAssets2=n:s==="realEstate"?e.realEstate2=n:s==="deemedAssets"?e.deemedAssets2=n:s==="debt"&&(e.debt2=n),$()}}),h.detailsTbody.addEventListener("focusin",a=>{const t=a.target;t&&t.classList.contains("table-input")&&t.select()})),h.yearsPassed&&(h.yearsPassed.addEventListener("input",b),h.yearsPassed.addEventListener("focus",a=>{a.target.select()})),b()};window.addEventListener("load",O);
